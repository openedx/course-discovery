# Discovery IDA: upstream API definitions, including vendor extensions.
# Note, while this document is not strictly to Swagger spec, each HTTP method"s
#  definition _must_ be to spec or the downstream ref will fail.

apigateway_responses: &apigateway_responses
  default:
    statusCode: "400"
  200:
    statusCode: "200"
  401:
    statusCode: "401"
  403:
    statusCode: "403"
  404:
    statusCode: "404"
  429:
      statusCode: "429"
  500:
      statusCode: "500"

produces_json: &produces_json
  - "application/json"

produces: &produces
  - "application/json"
  - "application/csv"

responses: &responses
  200:
    description: "OK"
  400:
    description: "Bad Request"
  401:
    description: "Unauthorized"
  403:
    description: "Forbidden"
  404:
    description: "Not Found"
  429:
    description: "Too Many Requests"
  500:
    description: "Internal Server Error"

id_parameter: &id_parameter
  name: "id"
  in: "path"
  required: true
  type: "number"

uuid_paramter: &uuid_parameter
  name: "uuid"
  in: "path"
  required: true
  type: "string"
  format: "uuid"

auth_header: &auth_header
  name: "Authorization"
  in: "header"
  required: true
  type: "string"

limit_qs_parameter: &limit_qs_parameter
  in: "query"
  name: "limit"
  required: false
  type: "number"

offset_qs_parameter: &offset_qs_parameter
  in: "query"
  name: "offset"
  required: false
  type: "number"

exclude_utm_parameter: &exclude_utm_parameter
  in: "query"
  name: "exclude_utm"
  required: false
  type: "number"

fields_parameter: &fields_parameter
  in: "query"
  name: "fields"
  required: false
  type: "string"

omit_parameter: &omit_parameter
  in: "query"
  name: "omit"
  required: false
  type: "string"

include_hidden_course_runs_parameter: &include_hidden_course_runs_parameter
  in: "query"
  name: "include_hidden_course_runs"
  required: false
  type: "number"

published_course_runs_only_parameter: &published_course_runs_only_parameter
  in: "query"
  name: "published_course_runs_only"
  required: false
  type: "number"

marketable_enrollable_course_runs_with_archived_parameter: &marketable_enrollable_course_runs_with_archived_parameter
  in: "query"
  name: "marketable_enrollable_course_runs_with_archived"
  required: false
  type: "number"

status_parameter: &status_parameter
  in: "query"
  name: "status"
  required: false
  type: "string"

q_parameter: &q_parameter
  in: "query"
  name: "q"
  required: false
  type: "string"

# AWS API Gateway vendor extension point. This information is used
#  by https://github.com/awslabs/aws-apigateway-importer.
x-amazon-apigateway-integration: &apigateway_integration
  responses: *apigateway_responses
  httpMethod: "GET"
  type: "http"
  requestParameters:
    integration.request.header.Authorization: "method.request.header.Authorization"

x-amazon-apigateway-integration-course-list: &apigateway_integration_course_list
  responses: *apigateway_responses
  httpMethod: "GET"
  type: "http"
  requestParameters:
    integration.request.header.Authorization: "method.request.header.Authorization"
    integration.request.querystring.limit: "method.request.querystring.limit"
    integration.request.querystring.offset: "method.request.querystring.offset"
    integration.request.querystring.exclude_utm: "method.request.querystring.exclude_utm"
    integration.request.querystring.fields: "method.request.querystring.fields"
    integration.request.querystring.omit: "method.request.querystring.omit"
    integration.request.querystring.include_hidden_course_runs: "method.request.querystring.include_hidden_course_runs"
    integration.request.querystring.q: "method.request.querystring.q"

x-amazon-apigateway-integration-course-detail: &apigateway_integration_course_detail
  responses: *apigateway_responses
  httpMethod: "GET"
  type: "http"
  requestParameters:
    integration.request.header.Authorization: "method.request.header.Authorization"
    integration.request.path.uuid: "method.request.path.uuid"
    integration.request.querystring.exclude_utm: "method.request.querystring.exclude_utm"
    integration.request.querystring.fields: "method.request.querystring.fields"
    integration.request.querystring.omit: "method.request.querystring.omit"
    integration.request.querystring.include_hidden_course_runs: "method.request.querystring.include_hidden_course_runs"
    integration.request.querystring.q: "method.request.querystring.q"

x-amazon-apigateway-integration-program-list: &apigateway_integration_program_list
  responses: *apigateway_responses
  httpMethod: "GET"
  type: "http"
  requestParameters:
    integration.request.header.Authorization: "method.request.header.Authorization"
    integration.request.querystring.limit: "method.request.querystring.limit"
    integration.request.querystring.offset: "method.request.querystring.offset"
    integration.request.querystring.exclude_utm: "method.request.querystring.exclude_utm"
    integration.request.querystring.fields: "method.request.querystring.fields"
    integration.request.querystring.omit: "method.request.querystring.omit"
    integration.request.querystring.published_course_runs_only: "method.request.querystring.published_course_runs_only"
    integration.request.querystring.marketable_enrollable_course_runs_with_archived: "method.request.querystring.marketable_enrollable_course_runs_with_archived"
    integration.request.querystring.status: "method.request.querystring.status"
    integration.request.querystring.q: "method.request.querystring.q"

x-amazon-apigateway-integration-program-detail: &apigateway_integration_program_detail
  responses: *apigateway_responses
  httpMethod: "GET"
  type: "http"
  requestParameters:
    integration.request.header.Authorization: "method.request.header.Authorization"
    integration.request.path.uuid: "method.request.path.uuid"
    integration.request.querystring.exclude_utm: "method.request.querystring.exclude_utm"
    integration.request.querystring.fields: "method.request.querystring.fields"
    integration.request.querystring.omit: "method.request.querystring.omit"
    integration.request.querystring.published_course_runs_only: "method.request.querystring.published_course_runs_only"
    integration.request.querystring.marketable_enrollable_course_runs_with_archived: "method.request.querystring.marketable_enrollable_course_runs_with_archived"
    integration.request.querystring.status: "method.request.querystring.status"
    integration.request.querystring.q: "method.request.querystring.q"

x-amazon-apigateway-integration-with-id: &apigateway_integration_with_id_parameter
  responses: *apigateway_responses
  httpMethod: "GET"
  type: "http"
  requestParameters:
    integration.request.header.Authorization: "method.request.header.Authorization"
    integration.request.path.id: "method.request.path.id"


endpoints:
  v1:

    # /v1/catalogs
    catalogs:
        get:
          produces: *produces
          parameters:
            - *auth_header
          operationId: "get_catalogs"
          responses: *responses
          x-amazon-apigateway-integration:
            <<: *apigateway_integration
            uri: "https://${stageVariables.discovery_host}/v1/catalogs/"

    # /v1/catalogs/{id}
    catalogById:
        get:
          produces: *produces
          parameters:
            - *auth_header
            - *id_parameter
          operationId: "get_catalog_by_id"
          responses: *responses
          x-amazon-apigateway-integration:
            <<: *apigateway_integration_with_id_parameter
            uri: "https://${stageVariables.discovery_host}/v1/catalogs/{id}/"

    # /v1/catalogs/{id}/courses
    catalogCourses:
        get:
          produces: *produces
          parameters:
            - *auth_header
            - *id_parameter
          operationId: "get_catalog_courses"
          responses: *responses
          x-amazon-apigateway-integration:
            <<: *apigateway_integration_with_id_parameter
            uri: "https://${stageVariables.discovery_host}/v1/catalogs/{id}/courses/"

    # /v1/courses
    courses:
        get:
          produces: *produces_json
          parameters:
            - *auth_header
            - *limit_qs_parameter
            - *offset_qs_parameter
            - *exclude_utm_parameter
            - *fields_parameter
            - *omit_parameter
            - *include_hidden_course_runs_parameter
            - *q_parameter
          operationId: "get_courses"
          responses: *responses
          x-amazon-apigateway-integration:
            <<: *apigateway_integration_course_list
            uri: "https://${stageVariables.discovery_host}/v1/courses/"

    # /v1/courses/{uuid}
    coursesByUuid:
        get:
          produces: *produces_json
          parameters:
            - *auth_header
            - *uuid_parameter
            - *exclude_utm_parameter
            - *fields_parameter
            - *omit_parameter
            - *include_hidden_course_runs_parameter
            - *q_parameter
          operationId: "get_courses_by_uuid"
          responses: *responses
          x-amazon-apigateway-integration:
            <<: *apigateway_integration_course_detail
            uri: "https://${stageVariables.discovery_host}/v1/courses/{uuid}/"

    # /v1/programs
    programs:
        get:
          produces: *produces_json
          parameters:
            - *auth_header
            - *limit_qs_parameter
            - *offset_qs_parameter
            - *exclude_utm_parameter
            - *fields_parameter
            - *omit_parameter
            - *published_course_runs_only_parameter
            - *marketable_enrollable_course_runs_with_archived_parameter
            - *status_parameter
            - *q_parameter
          operationId: "get_programs"
          responses: *responses
          x-amazon-apigateway-integration:
            <<: *apigateway_integration_program_list
            uri: "https://${stageVariables.discovery_host}/v1/programs/"

    # /v1/programs/{uuid}
    programsByUuid:
        get:
          produces: *produces_json
          parameters:
            - *auth_header
            - *uuid_parameter
            - *exclude_utm_parameter
            - *fields_parameter
            - *omit_parameter
            - *published_course_runs_only_parameter
            - *marketable_enrollable_course_runs_with_archived_parameter
            - *status_parameter
            - *q_parameter
          operationId: "get_programs_by_uuid"
          responses: *responses
          x-amazon-apigateway-integration:
            <<: *apigateway_integration_program_detail
            uri: "https://${stageVariables.discovery_host}/v1/programs/{uuid}/"
